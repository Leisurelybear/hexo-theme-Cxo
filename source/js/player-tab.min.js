!function(t){t("ie8-eventlistener/storage/util",function(t,e,n){"use strict";var r="_storage_key",i=0,o=function(){return[r,+new Date,i++,Math.random()].join("-")},a=1e4,s=function(){for(var t=[],e=0,n=localStorage.length;e<n;e++){var i=localStorage.key(e),o=i.split("-");if(o[0]===r){var a=parseFloat(o[1]);t.push({timestamp:a,key:i,valueOf:function(){return this.key},toString:function(){return this.key.toString()}})}}return t.sort(),t};n.exports={prefix:r,sent:i,storageKey:o,timeout:a,getLocalStorageKeys:s}})}("function"==typeof define&&define.amd?define:function(t){"use strict";return"object"==typeof module?function(t,e){e(require,exports,module)}:function(e,n){var r={exports:{}},i=function(e){return"jquery"===e&&(e="jQuery"),t[e]};n(i,r.exports,r),t[e]=r.exports}}(this)),function(t){t("ie8-eventlistener/storage",function(t,e,n){"use strict";var r=t("ie8-eventlistener/storage/util"),i=(r.prefix,r.sent,r.storageKey),o=r.timeout,a=function(t,e){var n=window.localStorage.getItem(t);if(void 0===e&&(e=null),null!==e||null!==n){var r=i();window.localStorage.setItem(r,JSON.stringify({key:t,oldValue:n,newValue:null===e?null:e.toString()})),setTimeout(function(){window.localStorage.removeItem(r)},o)}},s="onstorage"in document?{setItem:function(t,e){a(t,e),window.localStorage.setItem(t,e)},getItem:function(t){return window.localStorage.getItem(t)},removeItem:function(t){a(t,null),window.localStorage.removeItem(t)},clear:function(){window.localStorage.clear()}}:window.localStorage;n.exports=s})}("function"==typeof define&&define.amd?define:function(t){"use strict";return"object"==typeof module?function(t,e){e(require,exports,module)}:function(e,n){var r={exports:{}},i=function(e){return"jquery"===e&&(e="jQuery"),t[e]};n(i,r.exports,r),t[e]=r.exports}}(this)),function(t){t("ie8-eventlistener",function(t,e,n){"use strict";var r=t("ie8-eventlistener/storage"),i=t("ie8-eventlistener/storage/util");i.prefix,i.sent,i.storageKey,i.timeout;if("undefined"!=typeof Element&&!Element.prototype.addEventListener&&Element.prototype.attachEvent){var o=function(){var t=function(){};return function(e){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");t.prototype=e;var n=new t;t.prototype=null;for(var r in e){if(r in n)break;n[r]=e[r]}return n}}(),a=function(t,e,n){var r,i=t.length;for(r=0;r<i;r++)if(r in t&&(n&&t[r][n]===e||!n&&t[r]===e))return r;return-1},s=function(t){for(var e,n,r,i=0,o=this.length-1;i<=o;){if(r=e=i+o>>>1,n=this[e],n==t)return e;n<t?i=e+1:o=e-1}return-(i+1)},u=i.getLocalStorageKeys,d=u(),c=0===d.length?"":d[d.length-1].key;window.Event=Window.prototype.Event=function(t,e){if("undefined"==typeof t)throw new Error("Failed to construct 'Event': An event name must be provided.");t=String(t);var n=document.createEventObject();return n.type=t,n.bubbles=!(!e||void 0===e.bubbles)&&e.bubbles,n.cancelable=!(!e||void 0===e.cancelable)&&e.cancelable,n};var l=function(t,e){Window.prototype[t]=e,HTMLDocument.prototype[t]=e,Element.prototype[t]=e},p={storage:1,storagecommit:1,keyup:1,keypress:1,keydown:1,textinput:1,mousedown:1,mouseup:1,mousemove:1,mouseover:1,mouseout:1,mouseenter:1,mouseleave:1,click:1,dblclick:1},f=function(t){return t===window||t instanceof Window};l("addEventListener",function(t,e){if(e&&"function"==typeof e){t=String(t);var n=this,i=this;f(n)&&t in p&&(n=document),i._events||(i._events={}),i._events[t]||(i._events[t]=function(e){var n,d=i._events[e.type].list,l=d.slice(),p=-1,f=l.length;e.preventDefault=function(){e.cancelable!==!1&&(e.returnValue=!1)},e.stopPropagation=function(){e.cancelBubble=!0},e.stopImmediatePropagation=function(){e.cancelBubble=!0,e.cancelImmediate=!0},e.currentTarget=i,e.relatedTarget=e.fromElement||null,e.target=e.srcElement||i,e.timeStamp=(new Date).getTime(),e.clientX&&(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop);var m,v=[],y=function(){var t=o(e),r=v.length;for(m=0;m<r;m++){var s=v[m];for(p=0;p<f&&!e.cancelImmediate;p++){var u=o(t);if(s&&(u.key=s.key,u.oldValue=s.oldValue,u.newValue=s.newValue),p in l){n=l[p];var c=a(d,n);c!==-1&&n.call(i,u)}}}};if("storage"===t||"storagecommit"===t){var h=function(){var t=u(),e=s.call(t,c);e<0?e=~e:e++;var n;for(n=e;n<t.length;n++){var i=t[n].key,o=JSON.parse(r.getItem(i));c=i,v.push(o)}var a=+new Date,d=6e5;for(n=0;n<e&&(e>1e3||a-t[n].timestamp>d);n++)window.localStorage.removeItem(t[n]);y()};setTimeout(h,0)}else v.push(null),y()},i._events[t].list=[],n.attachEvent&&n.attachEvent("on"+t,i._events[t])),i._events[t].list.push(e)}}),l("removeEventListener",function(t,e){if(e&&"function"==typeof e){t=String(t);var n,r=this,i=this;f(i)&&t in p&&(i=document),r._events&&r._events[t]&&r._events[t].list&&(n=a(r._events[t].list,e),n!==-1&&(r._events[t].list.splice(n,1),r._events[t].list.length||(i.detachEvent&&i.detachEvent("on"+t,r._events[t]),delete r._events[t])))}}),l("dispatchEvent",function(t){if(!arguments.length)throw new Error("Not enough arguments");if(!t||"string"!=typeof t.type)throw new Error("DOM Events Exception 0");var e=this,n=this,r=t.type;f(n)&&r in p&&(n=document);try{t.bubbles||(t.cancelBubble=!0),e.fireEvent("on"+r,t)}catch(i){t.target=e;do t.currentTarget=e,"_events"in e&&"function"==typeof e._events[r]&&e._events[r].call(e,t),"function"==typeof e["on"+r]&&e["on"+r].call(e,t),e=9===e.nodeType?e.parentWindow:e.parentNode;while(e&&!t.cancelBubble)}return!0})}})}("function"==typeof define&&define.amd?define:function(t){"use strict";return"object"==typeof module?function(t,e){e(require,exports,module)}:function(e,n){var r={exports:{}},i=function(e){return"jquery"===e&&(e="jQuery"),t[e]};n(i,r.exports,r),t[e]=r.exports}}(this)),function(t,e){e("crosstab",function(e,n,r){"use strict";function i(){if(!K.supported){var e="crosstab not supported",n=[];throw T||n.push("localStorage not availabe"),t.addEventListener||n.push("addEventListener not available"),O&&n.push("mobile browser"),j&&n.push("frozen tab environment detected"),x||n.push("localStorage.setItem not allowed"),n.length>0&&(e+=": "+n.join(", ")),new Error(e)}}function o(t){if(t&&t.key in D.storageEventKeys){var e;try{e=t.newValue?JSON.parse(t.newValue):{}}catch(n){e={}}if(e&&e.id&&e.id!==K.id&&(t.newValue!==M||t.oldValue!==R))if(M=t.newValue,R=t.oldValue,t.key===D.keys.MESSAGE_KEY){var r=e.data;r.destination&&r.destination!==K.id||B.emit(r.event,r)}else t.key===D.keys.FROZEN_TAB_ENVIRONMENT?(j=e.data,K.supported=K.supported&&!e.data):t.key===D.keys.SUPPORTED_KEY&&(K.supported=K.supported&&e.data)}}function a(t,e){var n={id:K.id,data:e,timestamp:D.now()};T.setItem(t,JSON.stringify(n))}function s(t){var e=u(t);return e.data}function u(t){var e=T?T.getItem(t):null,n=e?JSON.parse(e):{};return n}function d(){K.stopKeepalive=!0;var t=0;D.forEach(D.tabs,function(e,n){n!==D.keys.MASTER_TAB&&t++}),1===t?(D.tabs={},k()):b(D.eventTypes.tabClosed,K.id)}function c(){K.stopKeepalive=!1,A()}function l(){t.removeEventListener("beforeunload",d,!1),t.addEventListener("unload",d,!1),c()}function p(){return D.tabs[D.keys.MASTER_TAB]}function f(t){D.tabs[D.keys.MASTER_TAB]=t}function m(){delete D.tabs[D.keys.MASTER_TAB]}function v(){var t=p();return t?t.id:0}function y(){return v()===K.id}function h(){var t=null;D.forEach(D.tabs,function(e){(!t||e.id<t)&&(t=e.id)}),t===K.id?b(D.eventTypes.tabPromoted,K.id):f({id:t,lastUpdated:D.now()})}function g(t,e,n){n=n||"0";var r=t.toString();return r.length>=e?r:new Array(e-r.length+1).join(n)+r}function b(t,e,n){K.supported||i();var r={id:D.generateId(),event:t,data:e,destination:n,origin:K.id,timestamp:D.now()};r.destination!==r.origin&&a(D.keys.MESSAGE_KEY,r),r.destination&&r.destination!==r.origin||B.emit(t,r)}function E(t,e){b(t,e,p().id)}function w(){K.supported=!1,j=!0,a(D.keys.FROZEN_TAB_ENVIRONMENT,!0),a(D.keys.SUPPORTED_KEY,!1)}function I(){var t=s(D.keys.TABS_KEY);return D.tabs=t||D.tabs||{},D.tabs}function k(){a(D.keys.TABS_KEY,D.tabs)}function _(){function t(t){return n-t.lastUpdated<z}function e(e,n){return n!==D.keys.MASTER_TAB&&!t(e)}var n=D.now(),r={id:K.id,lastUpdated:n};b(D.eventTypes.tabUpdated,r);var i=D.filter(D.tabs,e);if(D.forEach(i,function(t){b(D.eventTypes.tabClosed,t.id)}),!P){var o=p();if(o&&o.id!==r.id){var s,u;K.util.events.once("PONG",function(){P||(clearTimeout(s),a(D.keys.SUPPORTED_KEY,!0),a(D.keys.FROZEN_TAB_ENVIRONMENT,!1),D.events.emit("setupComplete"))}),u=D.now();var d=function(t){var e=D.now()-u;P||(t<=0&&e>Q?(w(),D.events.emit("setupComplete")):s=setTimeout(function(){d(t-1)},5))},c=5;s=setTimeout(function(){d(5)},Q-5*c),K.broadcastMaster("PING")}else o&&o.id===r.id&&D.events.emit("setupComplete")}}function A(){K.supported&&!K.stopKeepalive&&_()}var T,S=t.navigator&&(t.navigator.userAgent||t.navigator.vendor)||t.opera||"none",O=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(S)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(S.substr(0,4));try{T=t.localStorage,T=t["ie8-eventlistener/storage"]||t.localStorage}catch(N){}var x=!0;try{T.setItem("__crosstab",""),T.removeItem("__crosstab")}catch(N){x=!1}var j=!1,D={keys:{MESSAGE_KEY:"crosstab.MESSAGE_KEY",TABS_KEY:"crosstab.TABS_KEY",MASTER_TAB:"MASTER_TAB",SUPPORTED_KEY:"crosstab.SUPPORTED",FROZEN_TAB_ENVIRONMENT:"crosstab.FROZEN_TAB_ENVIRONMENT"}};D.isArray=Array.isArray||function(t){return t instanceof Array},D.isNumber=function(t){return"number"==typeof t},D.isFunction=function(t){return"function"==typeof t},D.forEachObj=function(t,e){for(var n in t)t.hasOwnProperty(n)&&e.call(t,t[n],n,t)},D.forEachArr=function(t,e){for(var n=t.length,r=0;r<n;r++)e.call(t,t[r],r,t)},D.forEach=function(t,e){D.isArray(t)?D.forEachArr(t,e):D.forEachObj(t,e)},D.map=function(t,e){var n=[];return D.forEach(t,function(t,r,i){n.push(e(t,r,i))}),n},D.filter=function(t,e){var n=D.isArray(t),r=n?[]:{};return n?D.forEachArr(t,function(t,n){e(t,n)&&r.push(t)}):D.forEachObj(t,function(t,n){e(t,n)&&(r[n]=t)}),r},D.reduce=function(t,e,n){var r=arguments.length<3;return D.forEach(t,function(t,i,o){r?(n=t,r=!1):n=e(n,t,i,o)}),n},D.now=function(){return(new Date).getTime()},D.tabs=I(),D.eventTypes={becomeMaster:"becomeMaster",demoteFromMaster:"demotedFromMaster",tabUpdated:"tabUpdated",tabClosed:"tabClosed",tabPromoted:"tabPromoted"},D.storageEventKeys=D.reduce(D.keys,function(t,e){return t[e]=1,t},{}),D.createEventHandler=function(){var t={},e={},n=function(t,n){var r;return e[t]&&(r=e[t][n]),r},r=function(e,n){var r=-1,i=t[e];if(i&&n)for(var o=i.length||0,a=0;a<o;a++)if(i[a]===n){r=a;break}return r},i=function(t,i,o){var a,s=d(t),u=n(t,o);return void 0===u?(a=s.length,s[a]=i,e[t]||(e[t]={}),o&&(e[t][o]=i)):(a=r(t,u),s[a]=i),o||i},o=function(i,o){var a=D.isFunction(o)?o:n(i,o),s=r(i,a);return s!==-1&&(!(!t[i]||!t[i][s])&&(t[i].splice(s,1),delete e[i][o],!0))},a=function(n){var r=!1;return n?(t[n]&&(delete t[n],r=!0),e[n]&&(delete e[n],r=r&&!0)):(t={},e={},r=!0),r},s=function(t){var e=Array.prototype.slice.call(arguments,1),n=d(t);D.forEach(n,function(t){D.isFunction(t)&&t.apply(this,e)})},u=function(t,e,r){for(;!r||void 0!==n(t,r);)r=D.generateId();return i(t,function(){o(t,r);var n=Array.prototype.slice.call(arguments);e.apply(this,n)},r),r},d=function(e){var n=t[e]=t[e]||[];return n},c=function(){a()};return{addListener:i,destructor:c,on:i,off:function(t,e){var n=arguments.length;return n?1===n?a(t):o(t,e):a()},once:u,emit:s,listeners:d,removeListener:o,removeAllListeners:a}};var B=D.createEventHandler();D.events={addListener:B.addListener,on:B.on,off:B.off,once:B.once,emit:B.emit,listeners:B.listeners,removeListener:B.removeListener,removeAllListeners:B.removeAllListeners,destructor:B.destructor};var M,R;B.addListener(D.eventTypes.tabClosed,function(t){var e=t.data;e in D.tabs&&delete D.tabs[e];var n=p();n&&n.id!==e?n.id===K.id&&k():(n&&m(),h())}),B.addListener(D.eventTypes.tabUpdated,function(t){var e=t.data;D.tabs[e.id]=e,p()||h(),v()===e.id&&f(e),y()&&k()});var L;B.addListener(D.eventTypes.tabPromoted,function(t){var e=t.data,n=t.timestamp,r=v();return K.id<e?void(L||(L=setTimeout(function(){L=0,b(D.eventTypes.tabPromoted,K.id)},0))):(f({id:e,lastUpdated:n}),y()&&k(),void(y()&&r!==K.id?D.events.emit(D.eventTypes.becomeMaster):y()||r!==K.id||D.events.emit(D.eventTypes.demoteFromMaster)))}),D.generateId=function(){return D.now().toString()+g(2147483647*Math.random()|0,10)};var P=!1;D.events.once("setupComplete",function(){P=!0});var K=function(t){P?t():D.events.once("setupComplete",t)};K.id=D.generateId(),K.supported=!!T&&t.addEventListener&&!O&&x,K.util=D,K.broadcast=b,K.broadcastMaster=E,K.on=D.events.on,K.once=D.events.once,K.off=D.events.off;var U=6e5;if(!P&&K.supported){var V=u(D.keys.FROZEN_TAB_ENVIRONMENT);if(V.timestamp){var F=V.data;D.now()-V.timestamp>U?T.removeItem(D.keys.FROZEN_TAB_ENVIRONMENT):F===!0&&w()}var Y=u(D.keys.SUPPORTED_KEY);if(Y.timestamp){var q=Y.data;D.now()-Y.timestamp>U?T.removeItem(D.keys.SUPPORTED_KEY):q!==!1&&q!==!0||(K.supported=q,D.events.emit("setupComplete"))}}var C=3e3,z=5e3,Q=500;K.supported?(t.addEventListener("storage",o,!1),t.addEventListener("beforeunload",d,!1),t.addEventListener("DOMContentLoaded",l,!1),D.events.on("PING",function(t){t.destination&&t.destination===K.id&&D.now()-t.timestamp<Q&&K.broadcast("PONG",null,t.origin)}),setInterval(A,C),A()):K.broadcast=i,r.exports=K})}("object"==typeof window?window:global,"function"==typeof define&&define.amd?define:function(t){"use strict";return"object"==typeof module?function(t,e){e(require,exports,module)}:function(e,n){var r={exports:{}},i=function(e){return"jquery"===e&&(e="jQuery"),t[e]};n(i,r.exports,r),t[e]=r.exports}}(this)),function(t,e){function n(t){return"/sound/getsound?soundid="+t}function r(t){return"/sound/soundAllList?albumid="+t}function i(t){return"/dramaapi/getdramasounds?drama_id="+t}function o(t){return"/person/getuser50?user_id="+t}function a(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}function s(){var t=this.getItem("playlist");if(t)try{this.mData=JSON.parse(t),a(this.mData)||this.clear()}catch(e){this.clear()}else this.clear()}function u(){this.list=new s,this.events={loading:null,play:null,add:null,replace:null,off:null,error:null}}var d=223692,c=null,l=!1;Object.prototype.hasOwnProperty;s.prototype.getItem=function(t){return store.get(t)},s.prototype.setItem=function(t,e){store.set(t,e)},s.prototype.iscurrent=function(t){return t=parseInt(t),sid=parseInt(this.getItem("current")),this.find(t)<0?(sid&&this.current(0),!1):t===sid},s.prototype.current=function(t){return null==t?parseInt(this.getItem("current")):(t=parseInt(t),this.setItem("current",t.toString()),t)},s.prototype.find=function(t){var e=this.data(),n=e.length;t=parseInt(t);for(var r=0;r<n;r++){var i=e[r];if(i.id===t)return r}return-1},s.prototype.findandupdate=function(t){var e=t;e.id=parseInt(t.id);var n=this.find(e.id);return n>=0&&(this.mData[n].originAlbumId&&(e.originAlbumId=this.mData[n].originAlbumId),this.mData[n]=e,this.update()),n},s.prototype.add=function(t,e){t.id=parseInt(t.id);var n=l?-1:this.find(t.id);return n<0?this.mData.push(t):this.mData[n]=t,e||this.current(t.id),this.update(),n<0},s.prototype.removeByIndex=function(t){if(t>=0&&t<this.mData.length){var e=this.mData.splice(t,1);return this.update(),e}},s.prototype.remove=function(t){var e=this.find(parseInt(t));return e>=0&&(this.mData.splice(e,1),this.update()),e},s.prototype.set=function(t){for(var e=0;e<t.length;e++)t[e].id=parseInt(t[e].id);this.mData=t,t.length>0?this.current(t[0].id):this.current(0),this.update()},s.prototype.clear=function(){this.setItem("playlist","[]"),this.mData=[],this.current(0)},s.prototype.update=function(){var t=this.mData.length-999;t>0&&(this.mData=this.mData.slice(t)),this.setItem("playlist",JSON.stringify(this.mData))},s.prototype.data=function(){return this.mData},s.prototype.get=function(t){var e=this.find(t);return e>=0?this.mData[e]:null},s.prototype.getByIndex=function(t){return this.mData[t]},u.NOT_FOUND_SOUNDID=d,u.prototype.emit=function(t){var e=this.events[t];if("function"==typeof e){var n=Array.prototype.slice.call(arguments,1);e.apply(this,n)}},u.prototype.on=function(t,e){t in this.events&&(this.events[t]=e)},u.prototype.hashcheck=function(t){for(var e=["id","album","drama","usertop50"],n=null,r=0;r<e.length;r++)e[r]in t&&(n=e[r]);if(n){var i=parseInt(t[n]);if(this.justopen||!l){this.justopen=!1;var r;if((r=this.list.find(i))>=0)return["select",r]}if(this.list.iscurrent(i))return null;var o=[n,i];return"id"!==n&&t.reverse&&1===parseInt(t.reverse)&&o.push({reverse:!0}),o}return null},u.prototype.ajax=function(t,n,r){var i=e.ajax({url:t,dataType:"json",success:function(t){if(t&&!t.success){var e=t.info;return"sound"===r&&(e=t&&t.info?{code:t.code,message:t.info.message,redirect:t.info.redirect}:"api failed"),n(e,t)}n(null,t)},error:function(t,e,r){n(r||"api "+e)}});return i},u.prototype.getBySoundId=function(t,e,r){t=parseInt(t);var i=this,o=n(t);c&&c.abort(),c=this.ajax(o,function(n,o){return n&&n.redirect&&!r?i.getBySoundId(n.redirect,function(n,r,i){return n?e(n,r,i):(r&&(r.redirect_id=r.id,r.id=t),e(null,i.sound,i))},!0):n?"abort"===n||"api failed"===n?e(n):e(n,o.info.sound,o.info):e(null,o.info.sound,o.info)},"sound")},u.prototype.getByAlbumId=function(t,e){var n=r(t);this.ajax(n,function(t,n){return t?e(t):void(n&&n.info&&n.info.sounds?e(null,n.info.sounds,n.info.album):e("api failed"))})},u.prototype.getByDramaId=function(t,e){var n=i(t);this.ajax(n,function(t,n){return t?e(t):void(n&&n.info?e(null,n.info):e("api failed"))})},u.prototype.getByUserId=function(t,e){var n=o(t);this.ajax(n,function(t,n){return t?e(t):void(n&&n.info?e(null,n.info,n.info):e("api failed"))})},u.prototype.current=function(t,e){var n="id="+t;if(e)n+="&from_album_id="+e;else{var r=this.getOriginAlbumId(t);r&&(n+="&from_album_id="+r)}this.urlQuery.parse(n),this.urlQuery.update()},u.prototype.update=function(t,e){var n=this;this.lastUpdateSoundId=t,this.getBySoundId(t,function(r,i,o){i&&n.list.findandupdate(i),n.lastUpdateSoundId==t&&(r?"abort"!=r&&(i?e(null,i,o):n.list.remove(t),n.emit("error",r)):e(r,i,o))})},u.prototype.setOriginAlbumId=function(t,e){var n=this.list.get(t);n.originAlbumId=e,this.list.findandupdate(n)},u.prototype.getOriginAlbumId=function(t){var e=this.urlQuery.params;return e.from_album_id&&parseInt(e.from_album_id)>0&&parseInt(e.id)===parseInt(t)?e.from_album_id:null},u.prototype.iammaster=function(){try{crosstab.broadcast("player",{event:"master"}),crosstab.broadcast("host",{event:"master"})}catch(t){}},u.prototype.reverse=function(t){if(!t)return[];for(var e=[],n=t.length-1;n>=0;n--)e.push(t[n]);return e},u.prototype.go=function(t){return this.play("id",t),!1},u.prototype.play=function(t,e,n){var r=this,i=!!n&&n.onlyadd;switch(r.emit("loading",t,e,i),t){case"id":r.getBySoundId(e,function(t,o){var a=o;if(a||(a=t.sound),t&&!a)return void r.emit("error",t);if(n&&"number"==typeof n.originAlbumId)a.originAlbumId=n.originAlbumId;else{var s=r.getOriginAlbumId(e);s&&(a.originAlbumId=s)}var u;(l||(u=r.list.find(e))<0)&&(u=r.list.add(a,i),r.emit("add",a,u)),i||r.emit("play",a,u)});break;case"drama":r.getByDramaId(e,function(t,e){return t?void r.emit("error",t):(n&&n.reverse&&e&&(e=r.reverse(e)),void("object"==typeof e?(r.list.set(e),r.emit("replace",e),e&&e.length&&r.emit("play",e[0],0)):r.play("id",d)))});break;case"album":r.getByAlbumId(e,function(t,o){var a=o;if(t)return void r.emit("error",t);for(var s=0;s<a.length;s++)a[s].originAlbumId=e;n&&n.reverse&&a&&(a=r.reverse(a)),r.list.set(a),r.emit("replace",a),a&&a.length&&!i&&r.emit("play",a[0],0)});break;case"usertop50":r.getByUserId(e,function(t,e){return t?void r.emit("error",t):(n&&n.reverse&&e&&(e=r.reverse(e)),r.list.set(e),r.emit("replace",e),void(e&&e.length&&!i&&r.emit("play",e[0],0)))});break;case"select":var o=e,a=r.list.getByIndex(o);a&&(r.list.current(a.id),r.emit("play",a,o))}},u.prototype.init=function(n){function r(){var t=i.hashcheck(o.params);if(t)isNaN(t[1])?i.play("id",d):i.play(t[0],t[1],t[2]);else{var e=i.list.current();e>0&&(i.play("id",e),o.parse("id="+e,!0),o.update())}}var i=this,o=new R.utils.UrlQuery;return this.urlQuery=o,"addEventListener"in t?(o.on("update",r),e(t).unload(function(){try{crosstab.broadcast("host",{event:"close"})}catch(t){}}),crosstab.on("player",function(t){var e=t.data;switch(e.event){case"ping":crosstab.broadcast("host",{event:"pingback"},t.origin);break;case"master":t.origin!==crosstab.id&&(crosstab.off("player"),i.emit("off",t.destination));break;case"play":var n=e.data[2],r=e.data[3];if("id"===e.data[0]){n||i.current(e.data[1],r);var o=i.list.find(e.data[1]);if(o>=0){if(n){i.setOriginAlbumId(e.data[1],r);break}e.data=["select",o]}}i.play(e.data[0],e.data[1],{onlyadd:n,originAlbumId:r})}}),this.iammaster(),n(null,this.list.data()),this.justopen=!0,void r()):void n("unsupported")},u.prototype.connect=function(t){var e=!1,n=this;crosstab.on("host",function(r){if(r.data)switch(r.data.event){case"pingback":e||(n.playerId=r.origin,t(),e=!0);break;case"master":n.playerId=r.origin,1===n.iamfather?n.iamfather=2:n.iamfather=0;break;case"close":n.playerId===r.origin&&(n.playerId=null)}}),setTimeout(function(){e||(e=!0,t())},2e3);try{crosstab.broadcast("player",{event:"ping"})}catch(r){e=!0,t(r)}},u.prototype.tell=function(t,e,n,r){var i=[t,e];if(n&&i.push(!0),"number"==typeof r&&i.push(r),!this.playerId)return!1;try{crosstab.broadcast("player",{event:"play",data:i},this.playerId)}catch(o){return o}return!0},u.prototype.attach=function(t,n){var r=this;this.connect(function(){});var i=e("a[target=_player]"),o=e(".dr-play-sound.play-album-sound.add"),a=e(".hot-modal-content .sound-add");n&&i.click(function(t){if(!r.playerId)return void(r.iamfather=1);if(2!==r.iamfather||!n){var i,o=!1,a=e(this),s=a.attr("href"),u=a.data("soundid");if(u||(i=s.match(/id=(\d+)/),i?u=i[1]:(i=s.match(/sound\/(\d+)/),i&&(u=i[1]))),u){var d=a.data("albumid");r.tell("id",parseInt(u),o,d)}else u=a.data("albumid"),u||(i=s.match(/album=(\d+)/),i&&(u=i[1])),u?r.tell("album",parseInt(u),o):(u=a.data("dramaid"),u||(i=s.match(/drama=(\d+)/),i&&(u=i[1])),u&&r.tell("album",parseInt(u),o));return!1}}),o.click(function(t){var n=!0,i=e(this),o=i.data("soundid"),a=i.data("albumid");if(o){var s,u=r.tell("id",parseInt(o),n,a);s=u===!0?"娣诲姞鎴愬姛":u===!1?"娌℃湁宸叉墦寮€鐨勬挱鏀鹃〉":"褰撳墠娴忚鍣ㄤ笉鏀寔璇ユ搷浣�",R.components.toggleToast(s)}else o=i.data("albumid"),o&&r.tell("album",parseInt(o),n);return!1}),a.click(function(t){var n,i=!1,o=e(this).data("soundid"),a=r.tell("id",o,i);return n=a===!0?"娣诲姞鎴愬姛":a===!1?"娌℃湁宸叉墦寮€鐨勬挱鏀鹃〉":"褰撳墠娴忚鍣ㄤ笉鏀寔璇ユ搷浣�",R.components.toggleToast(n),!1})},t.PlayerTab=u}(window,$);